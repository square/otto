<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Otto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An enhanced event bus for Android">
    <link href="static/bootstrap-combined.min.css" rel="stylesheet">
    <link href="static/app.css" rel="stylesheet">
    <link href="static/app-theme.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Roboto:400,300italic,100,100italic,300" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="static/html5shiv.min.js"></script><![endif]-->
  </head>
  <body data-target=".content-nav">
    <header>
      <div class="container">
        <div class="row">
          <div class="span5">
            <h1>Otto</h1>
          </div>
          <div class="span7">
            <menu>
              <ul>
                <li><a href="#download" class="menu download">Download <span class="version-tag">Latest</span></a></li>
                <li><a href="http://github.com/square/otto" data-title="View GitHub Project" class="menu github"><img src="static/icon-github.png" alt="GitHub"/></a></li>
                <li><a href="http://square.github.io/" data-title="Square Open Source Portal" class="menu square"><img src="static/icon-square.png" alt="Square"/></a></li>
              </ul>
            </menu>
          </div>
      </div>
    </header>
    <section id="subtitle">
      <div class="container">
        <div class="row">
          <div class="span12">
            <h2>An enhanced <strong>event bus</strong> for Android</h2>
          </div>
        </div>
      </div>
    </section>
    <section id="body">
      <div class="container">
        <div class="row">
          <div class="span9">
            <h3 id="introduction">Introduction</h3>
            <p>Otto is an event bus designed to decouple different parts of your application while still allowing them
            to communicate efficiently.  Objects subscribe via the bus to receive events, and publishers call the bus to
            broadcast events.  Publishers and subscribers need only know about the bus, not each other.</p>
            <p>Forked from Guava's EventBus, Otto adds unique functionality and specialization for the Android platform.</p>

            <h3 id="usage">Usage</h3>
            <p>Otto is designed with Android-specific use cases in mind and is intended for use as a singleton
            (though that is not required).  <strong>Otto operates on the main thread.</strong>  Unless otherwise noted, all bus operations will throw an exception if attempted from a background thread.

            <h4>Publishing</h4>
            <p>Publishing an event to the bus sends the event to any registered subscribers.</p>

            <p>To publish an event, call the <code>post</code> method:</p>
            <pre class="prettyprint">bus.post(new AnswerUpdated(42));</pre>

            <p>To publish from a background thread, call the <code>postOnMainThread</code> method:</P>
            <pre class="prettyprint">bus.postOnMainThread(new AnswerUpdated(42));</pre>

            <h4>Subscribing</h4>
            <p>Subscription is the complement to event publishing&mdash;it lets an object receive events.</p>
            <p>To subscribe to an event type, annotate a method with <code>@Subscribe</code>.</p>

            <pre class="prettyprint">@Subscribe public void onAnswerUpdated(AnswerUpdated event) {
    // TODO: React to the event somehow!
}</pre>
            <p>An object with <code>@Subscribe</code>-annotated methods must be registered with the bus to receive events.</p>
            <pre class="prettyprint">bus.register(this);  // "this" is an object with @Subscribe methods.</pre>

            <p>The annotated method can be named anything you like, but it must be public and it must have a single parameter.  The parameter's type determines which events the method will receive.  A class may have as many <code>@Subscribe</code>-annotated methods as you like.</p>
            <p><strong>Registering will only find methods on the immediate class type.</strong> Unlike the Guava event
            bus, Otto will not traverse the class hierarchy and add methods from base classes or interfaces that are
            annotated. This is an explicit design decision to improve performance of the library as well as keep your
            code simple and unambiguous.</p>

            <h4>Children and Scoping</h4>
            <p>An Otto bus can have children, which means a bus may be part of a tree of buses.  Any event published to a bus is delivered to every subscriber registered to a bus in the same tree.</p>
            <pre class="prettyprint">Bus child1 = bus.spawn();
child1.register(subscriber);
Bus child2 = bus.spawn();
child2.publish(event); // The subscriber on child1 will receive this event.</pre>

            <p>Buses can also be destroyed.  Once destroyed, a bus will no longer deliver events.  All references to a destroyed bus and its subscribers are released.  Destruction is performed recursively.</p>
            <pre class="prettyprint">Bus child1 = bus.spawn();
Bus grandchild1 = child1.spawn();
Bus child2 = bus.spawn();
bus.destroy(); // bus, child1, grandchild1, and child2 are all destroyed.</pre>

            <p>Spawning and destroying child buses is important mechanism for avoiding reference leaks.  It is the only way to release references from the bus to registered subscriber objects.</p>

            <h4>Event Delivery</h4>
            <p>Events published with <code>post</code> are delivered synchronously, so when program execution continues it is guaranteed that all subscribers have been called.</p>
            <p>Events published with <code>postOnMainThread</code>, which must be called from a background thread, are asynchronously delivered on the main thread.
            <p>An instance of any class may be published on the bus and it will only be dispatched to subscribers for that class and its superclasses.</p>
            <p>All events are delivered in order of publication.</p>

            <h4>Dead Events</h4>
            <p>When an event is published and there are no suitable subscribers, it is considered "dead".  The bus may be constructed with a handler which receives all dead events.  This is a useful diagnostic tool-- dead events generally indicate an unneeded publisher or a potential bug in a client's subscriber management.
            <pre class="prettyprint">class DeadEventLogger implements DeadEventHandler {
  @Override public void onDeadEvent(Object event) {
    Log.w("Event " + event + " was not delivered.");
  }
}

Bus bus = new OttoBus(new DeadEventLogger());</pre>

            <h3 id="download">Download</h3>
            <p><a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&g=com.squareup&a=otto&v=LATEST" class="dl version-href">&darr; <span class="version-tag">Latest</span> JAR</a></p>
            <p>The source code to Otto and this website is <a href="http://github.com/square/otto">available on GitHub</a>.</p>

            <h4>Maven</h4>
            <pre class="prettyprint">&lt;dependency>
  &lt;groupId>com.squareup&lt;/groupId>
  &lt;artifactId>otto&lt;/artifactId>
  &lt;version><span class="version pln"><em>(insert latest version)</em></span>&lt;/version>
&lt;/dependency></pre>
            <p>Once you've installed Otto, add the following lines to your <code>proguard-project.txt</code> file:</p>
            <pre class="prettyprint">-keepclassmembers class ** {
    @com.squareup.otto.Subscribe public *;
}</pre>
            <p>This ensures your annotated methods aren't removed by ProGuard.</p>

            <h3 id="contributing">Contributing</h3>
            <p>If you would like to contribute code you can do so through GitHub by forking the repository and sending a pull request.</p>
            <p>When submitting code, please make every effort to follow existing conventions and style in order to keep the code as readable as possible. Please also make sure your code compiles by running <code>mvn clean verify</code>.</p>
            <p>Before your code can be accepted into the project you must also sign the <a href="http://squ.re/sign-the-cla">Individual Contributor License Agreement (CLA)</a>.</p>

            <h3 id="license">License</h3>
            <pre>Copyright 2013 Square, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</pre>
          </div>
          <div class="span3">
            <div class="content-nav" data-spy="affix" data-offset-top="80">
              <ul class="nav nav-tabs nav-stacked primary">
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#usage">Usage</a></li>
                <li><a href="#download">Download</a></li>
                <li><a href="#contributing">Contributing</a></li>
                <li><a href="#license">License</a></li>
              </ul>
              <ul class="nav nav-pills nav-stacked secondary">
                <li><a href="https://plus.google.com/communities/109244258569782858265/stream/67e6b6dd-0dcd-40c8-9823-47319d798c25">Google+ Community</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="span12 logo">
            <a href="https://squareup.com"><img src="static/logo-square.png" alt="Square, Inc."/></a>
          </div>
        </div>
      </div>
    </section>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="static/bootstrap.min.js"></script>
    <script src="static/jquery.smooth-scroll.min.js"></script>
    <script src="static/jquery-maven-artifact.min.js"></script>
    <script src="static/prettify.js"></script>
    <script type="text/javascript">
      $(function() {
        // Syntax highlight code blocks.
        prettyPrint();

        // Spy on scroll position for real-time updating of current section.
        $('body').scrollspy();

        // Use smooth-scroll for internal links.
        $('a').smoothScroll();

        // Enable tooltips on the header nav image items.
        $('.menu').tooltip({
          placement: 'bottom',
          trigger: 'hover',
          container: 'body',
          delay: {
            show: 500,
            hide: 0
          }
        });

        // Look up the latest version of the library.
        $.fn.artifactVersion('com.squareup', 'otto', function(version, url) {
          $('.version').text(version);
          $('.version-tag').text('v' + version);
          $('.version-href').attr('href', url);
        });
      });
    </script>
  </body>
</html>
